<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fretboard Master: Pro Edition</title>
  <style>
    :root {
      --bg-slate-950: #020617;
      --bg-slate-900: #0f172a;
      --bg-slate-800: #1e293b;
      --bg-slate-700: #334155;
      --text-slate-200: #e2e8f0;
      --text-slate-400: #94a3b8;
      --text-slate-500: #64748b;
      --primary-600: #4f46e5;
      --primary-500: #6366f1;
      --rose-600: #e11d48;
      --rose-500: #f43f5e;
      --emerald-500: #10b981;
      --amber-500: #f59e0b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-slate-950);
      color: var(--text-slate-200);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Layout */
    .container { max-width: 72rem; margin: 0 auto; padding: 1rem; width: 100%; }
    .card {
      background-color: var(--bg-slate-900);
      border: 1px solid var(--bg-slate-800);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
      margin-bottom: 1.5rem;
    }
    
    /* Typography */
    h1 { 
      font-size: 1.5rem; 
      font-weight: 700; 
      background: linear-gradient(to right, #818cf8, #c084fc); 
      -webkit-background-clip: text; 
      color: transparent; 
    }
    .text-muted { color: var(--text-slate-400); font-size: 0.875rem; }
    .label-title { 
      display: block; font-size: 0.75rem; font-weight: 700; 
      color: var(--text-slate-500); text-transform: uppercase; 
      letter-spacing: 0.05em; margin-bottom: 0.5rem; 
    }

    /* Header */
    header {
      padding: 1rem 1.5rem;
      background-color: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--bg-slate-800);
      position: sticky; top: 0; z-index: 50;
      display: flex; align-items: center; gap: 1rem;
    }

    /* Controls */
    .control-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media (min-width: 768px) { .control-grid { grid-template-columns: 2fr 1.5fr 1fr; } }

    select, button.btn-toggle {
      width: 100%;
      background-color: var(--bg-slate-800);
      border: 1px solid var(--bg-slate-700);
      color: var(--text-slate-200);
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      font-size: 0.95rem;
      outline: none; cursor: pointer; transition: all 0.2s;
    }
    select:focus { border-color: var(--primary-500); }
    
    /* Optgroup styling support */
    optgroup { background: var(--bg-slate-900); color: var(--text-slate-500); font-style: normal; font-weight: 700; }
    option { background: var(--bg-slate-800); color: var(--text-slate-200); padding: 5px; }

    .key-selector { display: flex; flex-wrap: wrap; gap: 0.5rem; }
    .btn-key {
      width: 2.5rem; height: 2.5rem;
      border-radius: 0.5rem; font-weight: 700;
      border: 1px solid var(--bg-slate-700);
      background-color: var(--bg-slate-800);
      color: var(--text-slate-400);
      cursor: pointer;
    }
    .btn-key:hover { background-color: var(--bg-slate-700); color: white; }
    .btn-key.active {
      background-color: var(--primary-600);
      border-color: var(--primary-500);
      color: white;
      box-shadow: 0 0 10px rgba(79, 70, 229, 0.4);
    }

    /* Segmented Control */
    .segmented-control {
      display: flex;
      background: var(--bg-slate-900);
      border: 1px solid var(--bg-slate-700);
      border-radius: 0.5rem; overflow: hidden;
      margin-top: 0.25rem;
    }
    .segment-btn {
      flex: 1; padding: 0.5rem;
      background: none; border: none;
      border-right: 1px solid var(--bg-slate-700);
      color: var(--text-slate-400);
      font-size: 0.8rem; font-weight: 500;
      cursor: pointer;
    }
    .segment-btn:last-child { border-right: none; }
    .segment-btn.active { background: var(--bg-slate-700); color: white; }

    /* Fretboard */
    .fretboard-wrapper { overflow-x: auto; padding-bottom: 1rem; }
    .fretboard-scroll { min-width: 850px; position: relative; padding: 0 1rem; }
    
    .fret-numbers { display: flex; margin-left: 24px; margin-bottom: 4px; }
    .fret-num { flex: 1; text-align: center; font-family: monospace; font-size: 0.75rem; color: var(--text-slate-500); height: 1.5rem; position: relative; }
    .fret-dot { width: 6px; height: 6px; background: var(--bg-slate-700); border-radius: 50%; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); }

    .board {
      background: #181512;
      border: 2px solid var(--bg-slate-700);
      border-radius: 0.5rem;
      position: relative; overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    }
    
    .nut {
      position: absolute; left: 0; top: 0; bottom: 0; width: 24px;
      background: #27272a; border-right: 2px solid #52525b;
      display: flex; align-items: center; justify-content: center; z-index: 20;
    }
    .nut span { transform: rotate(-90deg); font-size: 10px; color: #71717a; letter-spacing: 2px; }

    .strings-layer { padding: 1rem 0 1rem 24px; display: flex; flex-direction: column; }
    .string-row { position: relative; display: flex; height: 3.5rem; align-items: center; }
    
    .string-wire {
      position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%);
      background: linear-gradient(to bottom, #a1a1aa, #52525b);
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      z-index: 1;
    }

    .fret-cell {
      flex: 1; height: 100%; border-right: 1px solid rgba(255,255,255,0.08);
      position: relative; z-index: 5;
      display: flex; align-items: center; justify-content: center;
    }
    .fret-cell.open { border-right: 4px solid var(--bg-slate-600); background: rgba(255,255,255,0.03); }

    .note {
      width: 2.2rem; height: 2.2rem;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 0.85rem;
      z-index: 10;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      transition: transform 0.15s;
    }
    .note:hover { transform: scale(1.1); }

    /* Colors */
    .note.root { background: var(--rose-600); color: white; box-shadow: 0 0 12px rgba(225, 29, 72, 0.6); z-index: 20; }
    .note.chord { background: var(--emerald-500); color: white; box-shadow: 0 0 10px rgba(16, 185, 129, 0.4); z-index: 15; }
    .note.scale { background: var(--primary-600); color: white; }
    .note.dim { opacity: 0.15; transform: scale(0.8); background: var(--bg-slate-700); }

    /* Legend */
    .legend { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1rem; font-size: 0.85rem; color: var(--text-slate-400); flex-wrap: wrap; }
    .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }

    footer { padding: 2rem; border-top: 1px solid var(--bg-slate-800); text-align: center; color: var(--text-slate-500); font-size: 0.8rem; margin-top: auto; }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body>

  <header>
    <div style="width: 2rem; height: 2rem; background: var(--primary-600); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white;">
      <!-- Music Icon -->
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
    </div>
    <h1>Fretboard Master <span style="font-size:0.8rem; opacity:0.6; font-weight:400; margin-left: 0.5rem; border: 1px solid var(--primary-500); padding: 2px 6px; border-radius: 4px; color: var(--primary-500);">PRO</span></h1>
  </header>

  <main class="container">

    <!-- Controls -->
    <section class="card">
      <div class="control-grid">
        
        <!-- Key Selection -->
        <div>
          <span class="label-title">Select Key</span>
          <div class="key-selector" id="key-container"></div>
        </div>

        <!-- Scale & Instrument -->
        <div class="flex flex-col gap-4">
          <div>
            <span class="label-title">Instrument</span>
            <select id="instrument-select">
              <option value="Guitar">Guitar (6 String)</option>
              <option value="Bass4">Bass (4 String)</option>
              <option value="Bass5">Bass (5 String)</option>
            </select>
          </div>
          <div>
            <span class="label-title">Scale / Mode</span>
            <select id="scale-select"></select>
          </div>
        </div>

        <!-- Focus Mode -->
        <div>
          <span class="label-title">Focus Mode</span>
          <div class="segmented-control">
            <button class="segment-btn active" data-focus="all">All Notes</button>
            <button class="segment-btn" data-focus="chord">Chord Tones</button>
            <button class="segment-btn" data-focus="root">Root Only</button>
          </div>
          <div style="margin-top: 1rem; border-top: 1px solid var(--bg-slate-800); padding-top: 1rem;">
             <span class="label-title">Theory Quick Tip</span>
             <p id="theory-tip" class="text-muted" style="line-height: 1.4; font-size: 0.9rem;">Select a scale to see details...</p>
          </div>
        </div>

      </div>
    </section>

    <!-- Fretboard -->
    <section class="card" style="padding: 0; overflow: hidden;">
      <div class="fretboard-wrapper">
        <div class="fretboard-scroll">
          
          <div class="fret-numbers" id="fret-nums"></div>

          <div class="board">
            <div class="nut"><span>NUT</span></div>
            <div class="strings-layer" id="strings-container"></div>
          </div>

        </div>
      </div>
      
      <div class="legend" style="padding: 1rem;">
        <div style="display:flex; align-items:center;"><span class="dot" style="background:var(--rose-600); box-shadow: 0 0 8px var(--rose-600);"></span>Root (1)</div>
        <div style="display:flex; align-items:center;"><span class="dot" style="background:var(--emerald-500); box-shadow: 0 0 8px var(--emerald-500);"></span>Chord Tone (3, 5, 7)</div>
        <div style="display:flex; align-items:center;"><span class="dot" style="background:var(--primary-600);"></span>Scale Note</div>
      </div>
    </section>

  </main>

  <footer>
    <p>Fretboard Master Pro • Advanced Music Theory Visualizer • Vanilla JS</p>
  </footer>

  <script>
    /** 
     * --- MUSIC THEORY ENGINE ---
     * 
     * Data Structure:
     * - interval: semitones from Root.
     * - logic: All scales are generated dynamically from intervals relative to the chosen key.
     * - pedagogy: Categorization is strict to separate tonal vs modal concepts.
     */

    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const MARKERS = [3, 5, 7, 9, 12, 15, 17, 19, 21, 24];

    // Tuning Definitions
    const INSTRUMENTS = {
      'Guitar': { strings: ['E', 'B', 'G', 'D', 'A', 'E'], frets: 15, baseThickness: 1 },
      'Bass4':  { strings: ['G', 'D', 'A', 'E'], frets: 15, baseThickness: 2.5 },
      'Bass5':  { strings: ['G', 'D', 'A', 'E', 'B'], frets: 15, baseThickness: 2.5 }
    };

    /**
     * SCALE DICTIONARY
     * Strictly grouped for pedagogical clarity.
     */
    const SCALE_LIBRARY = {
      
      // 1. BASIC DIATONIC SCALES (The foundation of Western Harmony)
      "1) BASIC DIATONIC SCALES": {
        "Major (Ionian)": {
          intervals: [0, 2, 4, 5, 7, 9, 11],
          description: "The Tonal Center. Happy, stable. Used as the reference for all other scales (1 2 3 4 5 6 7)."
        },
        "Natural Minor (Aeolian)": {
          intervals: [0, 2, 3, 5, 7, 8, 10],
          description: "The standard Minor Scale. Sad, serious. Relative minor of the Major scale (1 2 b3 4 5 b6 b7)."
        },
        "Harmonic Minor": {
          intervals: [0, 2, 3, 5, 7, 8, 11],
          description: "Natural Minor with a raised 7th. Exotic/Classical feel. Creates strong V7 -> i resolution."
        },
        "Melodic Minor": {
          intervals: [0, 2, 3, 5, 7, 9, 11],
          description: "Jazz Minor. Minor 3rd but Major 6th and 7th. Smooth, no 'avoid' notes."
        }
      },

      // 2. DIATONIC MODES (Must be learned as distinct colors)
      "2) DIATONIC MODES (7)": {
        "Ionian (Mode 1)": {
          intervals: [0, 2, 4, 5, 7, 9, 11],
          description: "Same notes as Major, but treated as a mode. Bright, resolved."
        },
        "Dorian (Mode 2)": {
          intervals: [0, 2, 3, 5, 7, 9, 10],
          description: "Minor with Natural 6. Funky, soulful (Santana, Pink Floyd). Less sad than Aeolian."
        },
        "Phrygian (Mode 3)": {
          intervals: [0, 1, 3, 5, 7, 8, 10],
          description: "Minor with Flat 2. Dark, Spanish, Metal. High tension."
        },
        "Lydian (Mode 4)": {
          intervals: [0, 2, 4, 6, 7, 9, 11],
          description: "Major with Sharp 4. Dreamy, cinematic, floaty (Steve Vai, Simpsons)."
        },
        "Mixolydian (Mode 5)": {
          intervals: [0, 2, 4, 5, 7, 9, 10],
          description: "Major with Flat 7. Bluesy, Rock, Jam Bands. Fits Dominant 7 chords."
        },
        "Aeolian (Mode 6)": {
          intervals: [0, 2, 3, 5, 7, 8, 10],
          description: "The Natural Minor mode. Pure minor sound."
        },
        "Locrian (Mode 7)": {
          intervals: [0, 1, 3, 5, 6, 8, 10],
          description: "Diminished triad (1 b3 b5). Unstable, unresolved. Used over m7b5 chords."
        }
      },

      // 3. PENTATONIC SCALES (5 Note Scales)
      "3) PENTATONIC SCALES": {
        "Major Pentatonic": {
          intervals: [0, 2, 4, 7, 9],
          description: "The Major scale without half-steps (1 2 3 5 6). Folk, Country, Pop."
        },
        "Minor Pentatonic": {
          intervals: [0, 3, 5, 7, 10],
          description: "The King of Guitar Scales (1 b3 4 5 b7). Rock, Blues basics."
        },
        "Dominant Pentatonic": {
          intervals: [0, 2, 4, 7, 10],
          description: "Major Pentatonic with b7 instead of 6. Fits perfectly over Dom7 chords."
        },
        "Japanese (Hirajoshi)": {
          intervals: [0, 2, 3, 7, 8],
          description: "Exotic 5-note scale. Dark, spacious, Koto-like sound."
        }
      },

      // 4. BLUES & JAZZ
      "4) BLUES & JAZZ": {
        "Blues Scale": {
          intervals: [0, 3, 5, 6, 7, 10],
          description: "Minor Pentatonic + Blue Note (b5). Essential for Blues expression."
        },
        "Bebop Major": {
          intervals: [0, 2, 4, 5, 7, 8, 9, 11],
          description: "Major scale with passing tone (#5). Keeps chord tones on the beat."
        },
        "Bebop Minor": {
          intervals: [0, 2, 3, 5, 7, 9, 10, 11],
          description: "Dorian with added Major 7 passing tone."
        },
        "Bebop Dominant": {
          intervals: [0, 2, 4, 5, 7, 9, 10, 11],
          description: "Mixolydian with Major 7 passing tone. The standard Jazz scale for V7 chords."
        },
        "Altered Scale": {
          intervals: [0, 1, 3, 4, 6, 8, 10],
          description: "Super Locrian. All tensions (b9, #9, b5, #5). For Altered Dominants."
        }
      },

      // 5. SYMMETRICAL / TENSION
      "5) SYMMETRICAL / TENSION": {
        "Whole Tone": {
          intervals: [0, 2, 4, 6, 8, 10],
          description: "All whole steps. Dreamy, no root feeling. Fits Augmented chords."
        },
        "Diminished (Half-Whole)": {
          intervals: [0, 1, 3, 4, 6, 7, 9, 10],
          description: "Symmetric (H-W). Used over Dominant 7th (V7) for tension."
        },
        "Diminished (Whole-Half)": {
          intervals: [0, 2, 3, 5, 6, 8, 9, 11],
          description: "Symmetric (W-H). Used over Fully Diminished chords (dim7)."
        }
      },

      // 6. EXOTIC / MODERN
      "6) EXOTIC / MODERN": {
        "Phrygian Dominant": {
          intervals: [0, 1, 4, 5, 7, 8, 10],
          description: "5th Mode of Harmonic Minor. Major 3rd with Flat 2. Middle-eastern/Flamenco."
        },
        "Lydian Dominant": {
          intervals: [0, 2, 4, 6, 7, 9, 10],
          description: "4th Mode of Melodic Minor. Lydian (#4) with b7. The 'Overtone' scale."
        }
      }
    };

    /** --- APP STATE --- **/
    const state = {
      key: 'E',
      instrument: 'Guitar',
      // Default selection
      scaleName: 'Minor Pentatonic', 
      category: '3) PENTATONIC SCALES',
      focus: 'all' // 'all', 'chord', 'root'
    };

    /** --- LOGIC ENGINE --- **/
    
    function getNoteIndex(note) { return NOTES.indexOf(note); }
    function getNoteFromStep(rootIdx, semitones) { return NOTES[(rootIdx + semitones) % 12]; }

    // Logic to determine "Chord Tones" (Approximation for generic scales)
    // Root=0, 3rd=3/4, 5th=6/7/8, 7th=9/10/11
    function isChordToneInterval(int) {
      return [0, 3, 4, 6, 7, 8, 9, 10, 11].includes(int); 
      // Note: We include variations of 5ths and 7ths to cover dim/aug/maj7/min7
    }

    function generateScaleData() {
      // Find scale def in library
      let scaleDef = null;
      if (SCALE_LIBRARY[state.category] && SCALE_LIBRARY[state.category][state.scaleName]) {
        scaleDef = SCALE_LIBRARY[state.category][state.scaleName];
      }

      if (!scaleDef) return {}; 

      const rootIdx = getNoteIndex(state.key);
      const map = {};

      scaleDef.intervals.forEach(int => {
        const noteName = getNoteFromStep(rootIdx, int);
        // Special logic for Chord Tones vs Scale Tones
        // We define specific intervals as "Chord Tones" (1, 3, 5, 7)
        // Root (0), m3(3), M3(4), b5(6), P5(7), #5(8), bb7(9), b7(10), M7(11)
        const isChordTone = isChordToneInterval(int);

        map[noteName] = {
          interval: int,
          isRoot: int === 0,
          isChordTone: isChordTone
        };
      });

      return { map, description: scaleDef.description };
    }

    /** --- UI RENDERING --- **/
    const els = {
      keys: document.getElementById('key-container'),
      inst: document.getElementById('instrument-select'),
      scale: document.getElementById('scale-select'),
      tip: document.getElementById('theory-tip'),
      frets: document.getElementById('fret-nums'),
      strings: document.getElementById('strings-container'),
      focusBtns: document.querySelectorAll('.segment-btn')
    };

    function init() {
      // 1. Render Keys
      els.keys.innerHTML = NOTES.map(n => 
        `<button class="btn-key ${n === state.key ? 'active' : ''}" onclick="setKey('${n}')">${n}</button>`
      ).join('');

      // 2. Render Scale Selector (Grouped)
      let optionsHTML = '';
      for (const [catName, scales] of Object.entries(SCALE_LIBRARY)) {
        optionsHTML += `<optgroup label="${catName}">`;
        for (const sName of Object.keys(scales)) {
          // Use just the name as value. We find category on change.
          optionsHTML += `<option value="${sName}" ${sName === state.scaleName ? 'selected' : ''}>${sName}</option>`;
        }
        optionsHTML += `</optgroup>`;
      }
      els.scale.innerHTML = optionsHTML;

      // 3. Listeners
      els.inst.onchange = (e) => { state.instrument = e.target.value; render(); };
      
      els.scale.onchange = (e) => { 
        state.scaleName = e.target.value;
        // Search category for state consistency
        for(const [cat, scales] of Object.entries(SCALE_LIBRARY)) {
          if(scales[state.scaleName]) {
            state.category = cat;
            break;
          }
        }
        render(); 
      };

      els.focusBtns.forEach(btn => {
        btn.onclick = () => {
          els.focusBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.focus = btn.dataset.focus;
          render();
        }
      });

      render();
    }

    function setKey(k) {
      state.key = k;
      document.querySelectorAll('.btn-key').forEach(b => {
        b.classList.toggle('active', b.textContent === k);
      });
      render();
    }

    function render() {
      const instData = INSTRUMENTS[state.instrument];
      const { map: scaleNotes, description } = generateScaleData();
      
      // Update Text
      els.tip.innerHTML = `<strong style="color:var(--primary-500)">${state.key} ${state.scaleName}</strong><br><span class="text-muted">${description}</span>`;

      // Render Frets
      let fretHTML = '<div class="fret-num"></div>';
      for(let i=1; i<=instData.frets; i++) {
        const marker = MARKERS.includes(i) ? '<div class="fret-dot"></div>' : '';
        fretHTML += `<div class="fret-num">${i}${marker}</div>`;
      }
      els.frets.innerHTML = fretHTML;

      // Render Strings
      els.strings.innerHTML = '';
      instData.strings.forEach((stringRoot, sIdx) => {
        const row = document.createElement('div');
        row.className = 'string-row';
        
        // Wire visual
        const wire = document.createElement('div');
        wire.className = 'string-wire';
        const thickness = instData.baseThickness + (sIdx * 0.6); 
        wire.style.height = `${thickness}px`;
        row.appendChild(wire);

        // Fret Cells
        for(let fret=0; fret<=instData.frets; fret++) {
          const rootIdx = getNoteIndex(stringRoot);
          const currentNote = getNoteFromStep(rootIdx, fret);
          const noteData = scaleNotes ? scaleNotes[currentNote] : null;

          const cell = document.createElement('div');
          cell.className = `fret-cell ${fret===0 ? 'open' : ''}`;
          
          if(noteData) {
            // Focus Logic
            let isVisible = false;
            let type = 'scale';

            if (noteData.isRoot) {
              type = 'root';
              isVisible = true; // Root always visible
            } else if (noteData.isChordTone) {
              type = 'chord';
              isVisible = (state.focus !== 'root');
            } else {
              isVisible = (state.focus === 'all');
            }

            if(isVisible) {
              const dot = document.createElement('div');
              dot.className = `note ${type}`;
              dot.textContent = currentNote;
              cell.appendChild(dot);
            }
          }
          row.appendChild(cell);
        }
        els.strings.appendChild(row);
      });
    }

    init();

  </script>
</body>
</html>
